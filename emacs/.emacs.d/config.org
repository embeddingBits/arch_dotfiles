#+title: eBits Emacs Config 

* Emacs Config
** Performance & Startup
*** Garbage Collection Optimization
#+begin_src emacs-lisp
(setq gc-cons-threshold most-positive-fixnum
      gc-cons-percentage 0.8)

(add-hook 'emacs-startup-hook
          (lambda ()
            (setq gc-cons-threshold (* 64 1024 1024)
                  gc-cons-percentage 0.1)))
#+end_src

*** Process Output Buffer
#+begin_src emacs-lisp
(setq read-process-output-max (* 4 1024 1024))
#+end_src

** UI Configuration
*** Clean Interface
#+begin_src emacs-lisp
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)

(setq inhibit-startup-message t
      ring-bell-function 'ignore
      visible-bell nil
      make-backup-files nil
      auto-save-default nil)
#+end_src

*** Dashboard
#+begin_src emacs-lisp
  (use-package dashboard
    :demand t
    :init
    (setq dashboard-items '((recents . 3)
                            (bookmarks . 5))
          dashboard-set-init-info nil)
    :config
    (setq dashboard-startup-banner
          (expand-file-name "~/Downloads/dashboard-1.jpeg")
          dashboard-banner-logo-title "eBits Emacs"
          dashboard-center-content t
          dashboard-vertically-center-content t
          dashboard-show-shortcuts nil
          dashboard-display-icons-p t
          dashboard-icon-type 'nerd-icons
          dashboard-set-heading-icons t
          dashboard-set-file-icons t)

    (dashboard-setup-startup-hook))
#+end_src

*** Window & Buffer Management
#+begin_src emacs-lisp
(setq dired-kill-when-opening-new-dired-buffer t)
#+end_src

*** Line Numbers & Visual Aids
#+begin_src emacs-lisp
(global-display-line-numbers-mode 1)
(setq display-line-numbers-type 'relative
      display-line-numbers-width 3)

(global-visual-line-mode 1)
(column-number-mode 1)
(add-hook 'prog-mode-hook #'hl-line-mode)
#+end_src

*** Scrolling Behavior
#+begin_src emacs-lisp
(setq scroll-step 1
      scroll-margin 8
      scroll-conservatively 101)
#+end_src

*** Font Configuration
#+begin_src emacs-lisp
(defvar +font "MartianMono Nerd Font Propo")

(when (member +font (font-family-list))
  (set-face-attribute 'default nil
                      :family +font
                      :height 130
                      :weight 'regular
                      :width 'condensed)

  (set-face-attribute 'fixed-pitch nil
                      :family +font
                      :height 130
                      :weight 'regular
                      :width 'condensed)

  (set-face-attribute 'variable-pitch nil
                      :family +font
                      :height 130
                      :weight 'regular
                      :width 'condensed))
#+end_src
*** Ligatures
Ligatures in Emacs
#+begin_src emacs-lisp
(use-package ligature
  :commands (ligature-mode global-ligature-mode)
  :hook (prog-mode . global-ligature-mode)
  :hook (org-mode . global-ligature-mode)
  :config
  (setq ligatures '("--" "---" "==" "===" "!=" "!==" "=!="
		    "=:=" "=/=" "<=" ">=" "&&" "&&&" "&=" "++" "+++" ";;" "!!" ; disable "***" because of Org-mode!
		    "??" "???" "?:" "?." "?=" "<:" ":<" ":>" ">:" "<:<" "<>" "<<<" ">>>"
		    "<<" ">>" "||" "-|" "_|_" "|-" "||-" "|=" "||=" "##" "###" "####"
		    "#{" "#[" "]#" "#(" "#?" "#_" "#_(" "#:" "#!" "#=" "^=" "<$>" "<$"
		    "$>" "<+>" "<+" "+>" "<*>" "<*" "*>" "</" "</>" "/>" "<!--" "<#--"
		    "-->" "->" "->>" "<<-" "<-" "<=<" "=<<" "<<=" "<==" "<=>" "<==>"
		    "==>" "=>" "=>>" ">=>" ">>=" ">>-" ">-" "-<" "-<<" ">->" "<-<" "<-|"
		    "<=|" "|=>" "|->" "<->" "<~~" "<~" "<~>" "~~" "~~>" "~>" "~-" "-~"
		    "~@" "[||]" "|]" "[|" "|}" "{|" "[<" ">]" "|>" "<|" "||>" "<||"
		    "|||>" "<|||" "<|>" "..." ".." ".=" "..<" ".?" "::" ":::" ":=" "::="
		    ":?" ":?>" "//" "///" "/*" "*/" "/=" "//=" "/==" "@_" "__" "???"
		    "<:<" ";;;"))

  (ligature-set-ligatures 'prog-mode ligatures)
  (ligature-set-ligatures 'org-mode ligatures))
#+end_src

*** Custom Faces
#+begin_src emacs-lisp
(custom-set-faces
 '(line-number ((t (:background "#1d2021" :foreground "#7c6f64"))))
 '(mode-line ((t (:background "#1d2021" :foreground "#ebdbb2"
                  :box (:line-width 2 :color "#1d2021")))))
 '(mode-line-inactive ((t (:background "#555555" :foreground "#eeeeee")))))
#+end_src

** Package Configuration
*** Use-Package Settings
#+begin_src emacs-lisp
(setq use-package-always-ensure t
      use-package-defer t)
#+end_src

*** Doom Modeline 
#+begin_src emacs-lisp
  (use-package doom-modeline
    :demand t
    :config
    (doom-modeline-mode 1))
  (setq doom-modeline-height 18)
#+end_src
*** Nerd Icons
#+begin_src emacs-lisp
  (use-package nerd-icons)
  (use-package nerd-icons-dired
    :hook (dired-mode . nerd-icons-dired-mode))
  (use-package nerd-icons-completion
  :config
  (nerd-icons-completion-mode)
  (add-hook 'marginalia-mode-hook #'nerd-icons-completion-marginalia-setup))
  (setq nerd-icons-scale-factor 1.1)
#+end_src
*** Completion Framework
#+begin_src emacs-lisp
(use-package vertico
  :init (vertico-mode 1))

(use-package marginalia
  :init (marginalia-mode 1))

(use-package which-key
  :config
  (which-key-mode 1))
#+end_src

** Evil Mode Configuration
#+begin_src emacs-lisp
(use-package evil
  :demand t
  :init
  (setq evil-want-integration t
        evil-want-keybinding nil
        evil-want-C-u-scroll t
        evil-want-C-i-jump nil)
  :config
  (evil-mode 1))

(use-package evil-collection
  :after evil
  :config
  (evil-collection-init))
#+end_src

*** General Keybindings
#+begin_src emacs-lisp
(use-package general
  :after evil
  :config
  ;; Leader key setup
  (general-create-definer my/leader
    :states '(normal visual)
    :prefix "SPC")
  
  ;; Global leader bindings
  (my/leader
    "f f" '(find-file :which-key "find file")
    "f s" '(save-buffer :which-key "save")
    "b b" '(switch-to-buffer :which-key "switch buffer")
    "b k" '(kill-buffer :which-key "kill buffer")
    "w q" '(kill-buffer-and-window :which-key "close window")
    "w v" '(split-window-right :which-key "split right")
    "w s" '(split-window-below :which-key "split below")))
#+end_src

*** Quick Global Keybindings
#+begin_src emacs-lisp
(global-set-key (kbd "C-c d") 'delete-file)
(global-set-key (kbd "C-c q") 'eshell)
(global-set-key (kbd "C-c c") 'compile)
(global-set-key (kbd "C-c v") 'vterm)
#+end_src

** Programming Configuration
*** Tree-sitter Support
#+begin_src emacs-lisp
(use-package treesit
  :ensure nil
  :config
  (setq treesit-language-source-alist
        '((zig "https://github.com/tree-sitter-grammars/tree-sitter-zig")
          (typst "https://github.com/uben0/tree-sitter-typst"))
        treesit-font-lock-level 4)
  
  (setq major-mode-remap-alist
        '((c-mode . c-ts-mode)
          (c++-mode . c++-ts-mode)
          (python-mode . python-ts-mode)
          (go-mode . go-ts-mode)
          (zig-mode . zig-ts-mode)
          (typst-mode . typst-ts-mode)
          (sh-mode . bash-ts-mode)
          (bash-mode . bash-ts-mode)
          (fish-mode . fish-ts-mode))))

(use-package treesit-auto
  :config
  (global-treesit-auto-mode))
#+end_src

*** Language-Specific Modes
#+begin_src emacs-lisp
  (use-package zig-ts-mode
    :vc (:url "https://codeberg.org/meow_king/zig-ts-mode"
              :rev :newest))

  (add-to-list 'auto-mode-alist '("\\.zig\\(?:\\.zon\\)?\\'" . zig-ts-mode))

  (use-package typst-ts-mode
    :mode "\\.typ\\'")

  (use-package websocket)
  (use-package typst-preview
    :init
    (setq typst-preview-browser "default"
          typst-preview-autostart t
          typst-preview-invert-colors "never"
          typst-preview-open-browser-automatically t)
    :custom
    (typst-preview-invert-colors "auto"))
#+end_src

*** Programming Defaults
#+begin_src emacs-lisp
(setq-default indent-tabs-mode nil
              tab-width 4)
(electric-pair-mode 1)
#+end_src

*** Visual Indent Guides
#+begin_src emacs-lisp
(use-package indent-bars
  :custom (indent-bars-treesit-support t)
  :hook ((emacs-lisp-mode
          c-ts-mode c++-ts-mode
          zig-ts-mode)))
#+end_src

** Completion & LSP
*** Snippets
#+begin_src emacs-lisp
  (use-package yasnippet
    :hook (prog-mode . yas-minor-mode)
    :hook (org-mode . yas-minor-mode)
    :config
    (yas-reload-all))

  (use-package yasnippet-snippets
    :after yasnippet)
#+end_src

*** Company Completion
#+begin_src emacs-lisp
  (use-package company
    :hook (prog-mode . company-mode)
    :hook (org-mode . company-mode)
    :config
    (setq company-minimum-prefix-length 1
          company-idle-delay 0.0
          company-tooltip-align-annotations t
          company-backends (cons 'company-capf company-backends)))
  (with-eval-after-load 'company
    (define-key company-active-map (kbd "<tab>") nil)
    (define-key company-active-map (kbd "TAB") nil))

  (setq yas-trigger-key "<tab>")
  (global-set-key (kbd "C-<tab>") #'company-complete)


  ;; Disable company in terminal modes
  (dolist (hook '(eshell-mode-hook shell-mode-hook term-mode-hook
                                   vterm-mode-hook minibuffer-setup-hook))
    (add-hook hook (lambda () (company-mode -1))))
#+end_src

*** Eglot LSP
#+begin_src emacs-lisp
  (use-package eglot
    :hook ((c-ts-mode . eglot-ensure)
           (c++-ts-mode . eglot-ensure)
           (zig-ts-mode . eglot-ensure)
           (typst-ts-mode . eglot-ensure)
           (go-ts-mode . eglot-ensure))
    :custom
    (eglot-autoshutdown t)
    (eglot-events-buffer-size 0)
    (eglot-inlay-hints-mode -1)
    (eglot-extend-to-xref nil)
    (eglot-ignored-server-capabilities
     '(:hoverProvider
       :documentHighlightProvider
       :documentFormattingProvider
       :documentRangeFormattingProvider
       :documentOnTypeFormattingProvider
       :colorProvider
       :foldingRangeProvider))
    (eglot-stay-out-of '(yasnippet)))

#+end_src

** Project & Version Control
#+begin_src emacs-lisp
(use-package rg)
(use-package magit)
#+end_src

** PDF Tools
#+begin_src emacs-lisp
  (use-package pdf-tools
    :config
    (pdf-loader-install)
    (setq-default pdf-view-display-size 'fit-page)
    (setq pdf-view-resize-factor 1.1)
  (setq pdf-view-midnight-colors '("#d5c4a1" . "#1d2021"))
    
    :hook (pdf-view-mode . (lambda () (display-line-numbers-mode -1))))
#+end_src

#+end_src
** Org Mode Configuration
*** Helper Functions
#+begin_src emacs-lisp
  (defun efs/org-mode-setup ()
    "Setup org-mode visual appearance."
    (variable-pitch-mode 1)
    (org-indent-mode)
    (display-line-numbers-mode -1)
    (visual-line-mode 1))

  (defun efs/org-font-setup ()
    "Configure org-mode fonts and styling."
    ;; Replace list hyphen with dot
    (font-lock-add-keywords
     'org-mode
     '(("^ *\\([-]\\) "
        (0 (prog1 ()
             (compose-region (match-beginning 1)
                             (match-end 1)
                             "•"))))))
    
    ;; Heading sizes
    (dolist (face '((org-level-1 . 1.4)
                    (org-level-2 . 1.3)
                    (org-level-3 . 1.2)
                    (org-level-4 . 1.1)
                    (org-level-5 . 1.1)
                    (org-level-6 . 1.1)
                    (org-level-7 . 1.1)
                    (org-level-8 . 1.1)))
      (set-face-attribute (car face) nil
                          :font "MartianMono Nerd Font Propo"
                          :weight 'regular
                          :width 'condensed
                          :height (cdr face)))
    
    ;; Fixed pitch for code blocks and tables
    (set-face-attribute 'org-block nil :inherit 'fixed-pitch)
    (set-face-attribute 'org-code nil :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-table nil :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-headline-done nil :foreground "#928374" :strike-through t)
    (set-face-attribute 'org-verbatim nil :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-special-keyword nil 
                        :inherit '(font-lock-comment-face fixed-pitch))
    (set-face-attribute 'org-meta-line nil 
                        :inherit '(font-lock-comment-face fixed-pitch))
    (set-face-attribute 'org-checkbox nil :inherit 'fixed-pitch))
#+end_src

*** Main Org Configuration
#+begin_src emacs-lisp
  (use-package org
    :hook (org-mode . efs/org-mode-setup)
    :config
    (setq org-ellipsis " ⤵"
          org-pretty-entities t
          org-hide-emphasis-markers t
          org-adapt-indentation t
          org-enforce-todo-dependencies t
          org-startup-indented t
          ;; Enable auto-fill for new headings and list items
          org-list-allow-alphabetical t
          org-return-follows-link nil)
    
    ;; TODO keywords
    (setq org-todo-keywords
          '((sequence "TODO(t)" "IN-PROG(p)" "WAITING(w)"
                      "|" "DONE(d)" "CANCELLED(c)")))
    
    (efs/org-font-setup)
    
    ;; Auto-insert headings and list items on RET
    (add-hook 'org-mode-hook
              (lambda ()
                (setq-local org-blank-before-new-entry 
                            '((heading . nil) (plain-list-item . nil))))))

  (add-hook 'org-src-mode-hook
            (lambda ()
              (when (derived-mode-p
                     'c-ts-mode
                     'c++-ts-mode
                     'python-ts-mode
                     'go-ts-mode
                     'zig-ts-mode
                     'typst-ts-mode)
                (eglot-ensure))))
#+end_src

*** Org Modern Styling
#+begin_src emacs-lisp
  (use-package org-modern
    :after org
    :hook (org-mode . org-modern-mode)
    :config
    (setq org-modern-star 'replace
          org-modern-replace-stars '("●" "○" "✸" "✿")
          org-modern-todo t
          org-modern-priority t
          org-modern-todo-faces
          '(("TODO" . (:foreground "#1d2021" :background "#ea6962" :weight bold))
            ("IN-PROG" . (:foreground "#1d2021" :background "#83a598" :weight bold))
            ("WAITING" . (:foreground "#1d2021" :background "#d8a657" :weight bold))
            ("DONE" . (:foreground "#1d2021" :background "#a9b665"))
            ("CANCELLED" . (:foreground "#cc241d" :strike-through t)))
          org-modern-priority-faces
          '((?A . (:foreground "#1d2021" :background "#ea6962" :weight bold))
            (?B . (:foreground "#1d2021" :background "#fe8019" :weight bold))           
            (?C . (:foreground "#1d2021" :background "#d79921" :weight bold))))) 
#+end_src
*** Org Roam
#+begin_src emacs-lisp
  (use-package org-roam
    :defer t
    :commands (org-roam-node-find
               org-roam-node-insert
               org-roam-capture
               org-roam-dailies-capture-today
               org-roam-dailies-goto-today)
    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("C-c n f" . org-roam-node-find)
           ("C-c n i" . org-roam-node-insert)
           ("C-c n c" . org-roam-capture)
           ("C-c n j" . org-roam-dailies-capture-today)
           ("C-c n J" . org-roam-dailies-goto-today))
    :custom
    (org-roam-directory (file-truename "~/Org-Notes/"))
    (org-roam-db-location (file-truename "~/Org-Notes/org-roam.db"))
    (org-roam-node-display-template (concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))
    (org-roam-completion-everywhere t)
    (org-roam-capture-templates
     '(("c" "Concept" plain
        "#+title: ${title}\n#+created: %<%d-%m-%Y %a %H:%M>\n#+filetags: ${subject} concept\n\n"
        :target (file+head "fleet/${college-personal}/${subject}/%<%d-%m-%Y>-${slug}.org"
                           "#+title: ${title}"))

       ("p" "Papers" plain
        "#+title: ${title}\n#+created: %<%d-%m-%Y %a %H:%M>\n#+filetags: ${about} concept\n\n"
        :target (file+head "literature/%<%d-%m-%Y>-${slug}.org"
                           "#+title: ${title}"))

       ("i" "inbox" plain
        "#+title: ${title}\n#+created: %<%d-%m-%Y %a %H:%M>\n#+filetags: inbox fleeting\n\n%?"
        :target (file+headline "inbox.org" "Inbox")
        :prepend t)))
    ;; Dailies – use dd-mm-yyyy format
    (org-roam-dailies-directory "daily/")
    (org-roam-dailies-capture-templates
     '(("d" "Default" entry
        "* %<%H:%M> %?"
        :if-new (file+head "%<%d-%m-%Y>.org" "#+title: %<%d-%m-%Y %a>\n"))))
    :config
    (org-roam-db-autosync-mode +1))

  (use-package org-roam-ui
    :ensure t
    :after org-roam
    :config
    (setq org-roam-ui-sync-theme t
          org-roam-ui-follow nil
          org-roam-ui-update-on-save t
          org-roam-ui-open-on-start t))
  (setq org-agenda-files (directory-files-recursively "~/Org-Notes/" "\\.org$"))
#+end_src
*** Org LaTeX
#+begin_src emacs-lisp
  (require 'ox-latex)
  (with-eval-after-load 'ox-latex
    ;; Your existing classes
    (add-to-list 'org-latex-classes
                 '("IEEEtran" ...))

    (add-to-list 'org-latex-classes
                 '("report" ...))

    ;; ... other classes ...

    ;; The new custom module class
    (add-to-list 'org-latex-classes
                 '("custom-module"
                   "\\documentclass[14pt]{extarticle}
  \\usepackage[utf8]{inputenc}
  \\usepackage[T1]{fontenc}
  \\usepackage[a4paper, margin=1in]{geometry}
  \\usepackage{fixltx2e}
  \\usepackage{graphicx}
  \\usepackage{longtable}
  \\usepackage{float}
  \\usepackage{wrapfig}
  \\usepackage{rotating}
  \\usepackage[normalem]{ulem}
  \\usepackage{amsmath}
  \\usepackage{textcomp}
  \\usepackage{marvosym}
  \\usepackage{wasysym}
  \\usepackage{amssymb}
  \\usepackage{hyperref}
  \\usepackage{mathpazo}
  \\usepackage{color}
  \\usepackage{parskip}
  \\usepackage{fancyhdr}
  \\usepackage{titlesec}
  \\usepackage{anyfontsize}

  \\pagestyle{fancy}
  \\fancyhf{}
  \\fancyhead[L]{\\leftmark}
  \\fancyhead[R]{Chapter}
  \\fancyfoot[C]{\\thepage}
  \\renewcommand{\\headrulewidth}{0.4pt}
  \\newcommand{\\sectionbreak}{\\clearpage}

  \\makeatletter
  \\renewcommand{\\maketitle}{
    \\begin{titlepage}
    \\centering
    \\vspace*{\\fill}
    {\\fontsize{80pt}{100pt}\\selectfont \\textbf{\\@title}}
    \\vspace*{\\fill}
    \\end{titlepage}
    \\thispagestyle{empty}
    \\clearpage
  }
  \\makeatother

  [NO-DEFAULT-PACKAGES]
  [PACKAGES]
  [EXTRA]"
                   ("\\section{%s}" . "\\section*{%s}")
                   ("\\subsection{%s}" . "\\subsection*{%s}")
                   ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                   ("\\paragraph{%s}" . "\\paragraph*{%s}")
                   ("\\subparagraph{%s}" . "\\subparagraph*{%s}"))))
#+end_src
*** Org Appear
#+begin_src emacs-lisp
(use-package org-appear
  :hook (org-mode . org-appear-mode)
  :config
  (setq org-appear-autoemphasis t
        org-appear-autolinks t
        org-appear-autosubmarkers t))
#+end_src

*** Org Mode Keybindings
#+begin_src emacs-lisp
(with-eval-after-load 'org
  ;; Org-mode specific keybindings
  (define-key org-mode-map (kbd "C-c t") 'org-todo)
  (define-key org-mode-map (kbd "C-c T") 'org-show-todo-tree)
  
  ;; Structure editing
  (define-key org-mode-map (kbd "C-c i") 'org-insert-heading-respect-content)
  (define-key org-mode-map (kbd "C-c I") 'org-insert-subheading)
  (define-key org-mode-map (kbd "C-c h") 'org-insert-heading)
  (define-key org-mode-map (kbd "C-c *") 'org-ctrl-c-star)
  
  ;; Planning & scheduling
  (define-key org-mode-map (kbd "C-c d") 'org-deadline)
  (define-key org-mode-map (kbd "C-c s") 'org-schedule)
  (define-key org-mode-map (kbd "C-c D") 
    (lambda () (interactive) (org-deadline '(4))))
  (define-key org-mode-map (kbd "C-c S") 
    (lambda () (interactive) (org-schedule '(4))))
  
  ;; Organization
  (define-key org-mode-map (kbd "C-c r") 'org-refile)
  (define-key org-mode-map (kbd "C-c a") 'org-archive-subtree)
  
  ;; Links
  (define-key org-mode-map (kbd "C-c l") 'org-insert-link)
  (define-key org-mode-map (kbd "C-c L") 'org-store-link)
  
  ;; Lists
  (define-key org-mode-map (kbd "C-c b") 'org-cycle-list-bullet)
  
  ;; Properties & tags
  (define-key org-mode-map (kbd "C-c p") 'org-set-property)
  (define-key org-mode-map (kbd "C-c :") 'org-set-tags-command)
  
  ;; Clocking
  (define-key org-mode-map (kbd "C-c x i") 'org-clock-in)
  (define-key org-mode-map (kbd "C-c x o") 'org-clock-out)
  (define-key org-mode-map (kbd "C-c x c") 'org-clock-cancel)
  
  ;; Export
  (define-key org-mode-map (kbd "C-c e") 'org-export-dispatch)
  
  ;; Promote/demote with arrow keys
  (define-key org-mode-map (kbd "M-<left>") 'org-metaleft)
  (define-key org-mode-map (kbd "M-<right>") 'org-metaright)
  (define-key org-mode-map (kbd "M-<up>") 'org-metaup)
  (define-key org-mode-map (kbd "M-<down>") 'org-metadown)
  
  ;; Promote/demote subtree
  (define-key org-mode-map (kbd "M-S-<left>") 'org-shiftmetaleft)
  (define-key org-mode-map (kbd "M-S-<right>") 'org-shiftmetaright)
  (define-key org-mode-map (kbd "M-S-<up>") 'org-shiftmetaup)
  (define-key org-mode-map (kbd "M-S-<down>") 'org-shiftmetadown))
#+end_src

** Custom Variables
#+begin_src emacs-lisp
(custom-set-variables
 '(dashboard-footer-messages
   '("Yadā yadā hi dharmasya glānir bhavati bhārata |\nAbhyutthānam adharmasya tadātmānaṁ sṛjāmyaham |")))
#+end_src
